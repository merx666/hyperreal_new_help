{% extends 'help_section/base.html' %}

{% block title %}Ustawienia powiadomień - HyperReal Help{% endblock %}

{% block extra_css %}
<style>
.preferences-container {
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
}

.preferences-header {
    text-align: center;
    margin-bottom: 30px;
    padding-bottom: 15px;
    border-bottom: 2px solid #e0e0e0;
}

.preferences-title {
    color: #333;
    margin-bottom: 10px;
}

.preferences-subtitle {
    color: #666;
    font-size: 1.1em;
}

.preferences-form {
    background: white;
    border-radius: 8px;
    padding: 30px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.preference-group {
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 1px solid #f0f0f0;
}

.preference-group:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.preference-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 0;
    border-bottom: 1px solid #f8f9fa;
}

.preference-item:last-child {
    border-bottom: none;
}

.preference-label {
    flex: 1;
    margin-right: 20px;
}

.preference-title {
    font-weight: 600;
    color: #333;
    margin-bottom: 5px;
}

.preference-description {
    color: #666;
    font-size: 0.9em;
    line-height: 1.4;
}

.toggle-switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 34px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 34px;
}

.slider:before {
    position: absolute;
    content: "";
    height: 26px;
    width: 26px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: #007bff;
}

input:checked + .slider:before {
    transform: translateX(26px);
}

.group-title {
    font-size: 1.2em;
    font-weight: 600;
    color: #333;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
}

.group-title i {
    margin-right: 10px;
    color: #007bff;
}

.save-button {
    width: 100%;
    padding: 15px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1.1em;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 20px;
}

.save-button:hover {
    background: #0056b3;
    transform: translateY(-2px);
}

.save-button:disabled {
    background: #6c757d;
    cursor: not-allowed;
    transform: none;
}

.success-message {
    background: #d4edda;
    color: #155724;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    border: 1px solid #c3e6cb;
    display: none;
}

.back-link {
    display: inline-block;
    margin-bottom: 20px;
    color: #007bff;
    text-decoration: none;
    font-weight: 500;
}

.back-link:hover {
    color: #0056b3;
    text-decoration: none;
}

.back-link i {
    margin-right: 8px;
}
</style>
{% endblock %}

{% block content %}
<div class="preferences-container">
    <a href="{{ url('notifications') }}" class="back-link">
        <i class="fas fa-arrow-left" aria-hidden="true"></i> Powrót do powiadomień
    </a>
    
    <div class="preferences-header">
        <h1 class="preferences-title">Ustawienia powiadomień</h1>
        <p class="preferences-subtitle">Dostosuj sposób otrzymywania powiadomień do swoich potrzeb</p>
    </div>

    <div class="success-message" id="successMessage">
        <i class="fas fa-check-circle" aria-hidden="true"></i> Ustawienia zostały pomyślnie zapisane!
    </div>

    <form class="preferences-form" id="preferencesForm" role="form" aria-label="Formularz ustawień powiadomień">
        {{ csrf_token() }}
        
        <!-- Główne ustawienia -->
        <div class="preference-group">
            <div class="group-title">
                <i class="fas fa-envelope" aria-hidden="true"></i>
                Główne ustawienia
            </div>
            
            <div class="preference-item">
                <div class="preference-label">
                    <div class="preference-title">Powiadomienia e-mail</div>
                    <div class="preference-description">Otrzymuj powiadomienia na adres e-mail</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" name="email_notifications" {% if preferences.email_notifications %}checked{% endif %} aria-label="Włącz lub wyłącz powiadomienia e-mail">
                    <span class="slider" aria-hidden="true"></span>
                </label>
            </div>
        </div>

        <!-- Powiadomienia o placówkach -->
        <div class="preference-group">
            <div class="group-title">
                <i class="fas fa-building" aria-hidden="true"></i>
                Powiadomienia o placówkach
            </div>
            
            <div class="preference-item">
                <div class="preference-label">
                    <div class="preference-title">Nowe placówki</div>
                    <div class="preference-description">Powiadomienia o dodaniu nowych placówek do bazy</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" name="new_facilities" {% if preferences.new_facilities %}checked{% endif %} aria-label="Włącz lub wyłącz powiadomienia o nowych placówkach">
                    <span class="slider" aria-hidden="true"></span>
                </label>
            </div>
            
            <div class="preference-item">
                <div class="preference-label">
                    <div class="preference-title">Aktualizacje placówek</div>
                    <div class="preference-description">Powiadomienia o zmianach w danych placówek</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" name="facility_updates" {% if preferences.facility_updates %}checked{% endif %} aria-label="Włącz lub wyłącz powiadomienia o aktualizacjach placówek">
                    <span class="slider" aria-hidden="true"></span>
                </label>
            </div>
        </div>

        <!-- Powiadomienia społecznościowe -->
        <div class="preference-group">
            <div class="group-title">
                <i class="fas fa-users" aria-hidden="true"></i>
                Aktywność społeczności
            </div>
            
            <div class="preference-item">
                <div class="preference-label">
                    <div class="preference-title">Nowe komentarze</div>
                    <div class="preference-description">Powiadomienia o nowych komentarzach w placówkach</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" name="new_comments" {% if preferences.new_comments %}checked{% endif %} aria-label="Włącz lub wyłącz powiadomienia o nowych komentarzach">
                    <span class="slider" aria-hidden="true"></span>
                </label>
            </div>
            
            <div class="preference-item">
                <div class="preference-label">
                    <div class="preference-title">Nowe oceny</div>
                    <div class="preference-description">Powiadomienia o nowych ocenach placówek</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" name="new_ratings" {% if preferences.new_ratings %}checked{% endif %} aria-label="Włącz lub wyłącz powiadomienia o nowych ocenach">
                    <span class="slider" aria-hidden="true"></span>
                </label>
            </div>
        </div>

        <!-- Newsletter -->
        <div class="preference-group">
            <div class="group-title">
                <i class="fas fa-newspaper" aria-hidden="true"></i>
                Newsletter
            </div>
            
            <div class="preference-item">
                <div class="preference-label">
                    <div class="preference-title">Newsletter</div>
                    <div class="preference-description">Otrzymuj regularne newslettery z najważniejszymi informacjami</div>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" name="newsletter" {% if preferences.newsletter %}checked{% endif %} aria-label="Włącz lub wyłącz newsletter">
                    <span class="slider" aria-hidden="true"></span>
                </label>
            </div>
        </div>

        <button type="submit" class="save-button" aria-label="Zapisz ustawienia powiadomień">
            <i class="fas fa-save" aria-hidden="true"></i> Zapisz ustawienia
        </button>
    </form>
</div>

<script>
document.getElementById('preferencesForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const saveButton = this.querySelector('.save-button');
    const successMessage = document.getElementById('successMessage');
    
    // Disable button during save
    saveButton.disabled = true;
    saveButton.innerHTML = '<i class="fas fa-spinner fa-spin" aria-hidden="true"></i> Zapisywanie...';
    
    fetch('{{ url("notification_preferences") }}', {
        method: 'POST',
        body: formData,
        headers: {
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            successMessage.style.display = 'block';
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Wystąpił błąd podczas zapisywania ustawień.');
    })
    .finally(() => {
        // Re-enable button
        saveButton.disabled = false;
        saveButton.innerHTML = '<i class="fas fa-save" aria-hidden="true"></i> Zapisz ustawienia';
    });
});
</script>
{% endblock %}